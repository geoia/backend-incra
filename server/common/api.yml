openapi: 3.0.1
info:
  title: GeoIA Backend
  description: API que descreve as APIs oferecidas pelo serviço
  version: 0.1.0
servers:
  - url: /api
tags:
  - name: Assentamentos
    description: API para consulta de assentamentos
  - name: Mapas
    description: API para consulta de mapas
  - name: Queimadas
    description: API para consulta de dados de queimadas
  - name: Estatisticas
    description: API para consulta de estatisticas de queimadas
  - name: Scripts
    description: API para executar scripts que preparam o ambiente.
  - name: Uploads
    description: API que permite o envio de arquivos para processamento.
  - name: Specification
    description: The swagger API specification
paths:
  /mapas/municipio/{id}:
    get:
      tags:
        - Mapas
      parameters:
        - $ref: '#/components/parameters/municipio_id'
      responses:
        200:
          description: Retorna mapa do municipio no formato GeoJson
        404:
          description: Não existem dados para a consulta
  /mapas/estado/{id}:
    get:
      tags:
        - Mapas
      parameters:
        - $ref: '#/components/parameters/estado_id'
      responses:
        200:
          description: Retorna mapa do estado no formato GeoJson
        404:
          description: Não existem dados para a consulta
  /mapas/bioma/{id}:
    get:
      tags:
        - Mapas
      parameters:
        - $ref: '#/components/parameters/bioma'
      responses:
        200:
          description: Retorna mapa do bioma no formato GeoJson
        404:
          description: Não existem dados para a consulta

  /assentamentos:
    get:
      tags:
        - Assentamentos
      responses:
        200:
          description: Retorna a lista assentamentoss
        204:
          description: Não existem dados para a consulta

  /assentamentos/{id}:
    get:
      tags:
        - Assentamentos
      parameters:
        - $ref: '#/components/parameters/assentamento_id'
      responses:
        200:
          description: Retorna a lista assentamentoss
        204:
          description: Não existem dados para a consulta

  /queimadas/sources:
    get:
      tags:
        - Queimadas
      responses:
        200:
          description: Retorna a lista fontes com dados sobre queimadas no formato YYYYMM
        204:
          description: Não existem dados para a consulta

  /queimadas/{source}/municipios:
    get:
      tags:
        - Queimadas
      parameters:
        - $ref: '#/components/parameters/source'
        - $ref: '#/components/parameters/full'
      responses:
        200:
          description: Retorna os municipios e se estes possuem queimadas
        204:
          description: Não existem dados para a consulta
  /queimadas/{source}/municipios/{id}:
    get:
      tags:
        - Queimadas
      parameters:
        - $ref: '#/components/parameters/source'
        - $ref: '#/components/parameters/municipio_id'
        - $ref: '#/components/parameters/page'
        - $ref: '#/components/parameters/per_page'
        - $ref: '#/components/parameters/detailed'
      responses:
        200:
          description: Retorna dados de queimadas do municipio no formato GeoJson
        204:
          description: Não existem dados para a consulta
  /queimadas/{source}/estados:
    get:
      tags:
        - Queimadas
      parameters:
        - $ref: '#/components/parameters/source'
        - $ref: '#/components/parameters/full'
      responses:
        200:
          description: Retorna os estados e se estes possuem queimadas
        204:
          description: Não existem dados para a consulta
  /queimadas/{source}/estados/{id}:
    get:
      tags:
        - Queimadas
      parameters:
        - $ref: '#/components/parameters/source'
        - $ref: '#/components/parameters/estado_id'
        - $ref: '#/components/parameters/page'
        - $ref: '#/components/parameters/per_page'
        - $ref: '#/components/parameters/detailed'
      responses:
        200:
          description: Retorna dados de queimadas do estado no formato GeoJson
        204:
          description: Não existem dados para a consulta
  /queimadas/{source}/biomas:
    get:
      tags:
        - Queimadas
      parameters:
        - $ref: '#/components/parameters/source'
        - $ref: '#/components/parameters/full'
      responses:
        200:
          description: Retorna os biomas e se estes possuem queimadas
        204:
          description: Não existem dados para a consulta
  /queimadas/{source}/biomas/{id}:
    get:
      tags:
        - Queimadas
      parameters:
        - $ref: '#/components/parameters/source'
        - $ref: '#/components/parameters/bioma'
        - $ref: '#/components/parameters/page'
        - $ref: '#/components/parameters/per_page'
        - $ref: '#/components/parameters/detailed'
      responses:
        200:
          description: Retorna dados de queimadas do bioma no formato GeoJson
        204:
          description: Não existem dados para a consulta
  /estatisticas/municipios:
    get:
      tags:
        - Estatisticas
      responses:
        200:
          description: Retorna todos os municipios que possuem dados de queimadas
        204:
          description: Não existem dados para a consulta
  /estatisticas/municipios/{id}:
    get:
      tags:
        - Estatisticas
      parameters:
        - $ref: '#/components/parameters/municipio_id'
        - $ref: '#/components/parameters/year'
      responses:
        200:
          description: Retorna estatisticas de queimadas do municipio
        204:
          description: Não existem dados para a consulta

  /estatisticas/estados:
    get:
      tags:
        - Estatisticas
      responses:
        200:
          description: Retorna todos os estados que possuem dados de queimadas
        204:
          description: Não existem dados para a consulta
  /estatisticas/estados/{id}:
    get:
      tags:
        - Estatisticas
      parameters:
        - $ref: '#/components/parameters/estado_id'
        - $ref: '#/components/parameters/year'
      responses:
        200:
          description: Retorna estatisticas de queimadas do estado
        204:
          description: Não existem dados para a consulta

  /estatisticas/biomas:
    get:
      tags:
        - Estatisticas
      responses:
        200:
          description: Retorna todos os biomas que possuem dados de queimadas
        204:
          description: Não existem dados para a consulta

  /estatisticas/biomas/{id}:
    get:
      tags:
        - Estatisticas
      parameters:
        - $ref: '#/components/parameters/bioma_id'
        - $ref: '#/components/parameters/year'
      responses:
        200:
          description: Retorna estatisticas de queimadas do bioma
        204:
          description: Não existem dados para a consulta

  /scripts/assentamentos:
    post:
      security:
        - BasicAuth: []
      tags:
        - Scripts
      parameters:
        - $ref: '#/components/parameters/override'
      responses:
        202:
          description: Script foi iniciado de forma assincrona
        401:
          description: Credenciais inválidas ou não fornecidas.

  /scripts/download-mapas:
    post:
      security:
        - BasicAuth: []
      tags:
        - Scripts
      parameters:
        - $ref: '#/components/parameters/override'
      responses:
        202:
          description: Script foi iniciado de forma assincrona
        401:
          description: Credenciais inválidas ou não fornecidas.
  /scripts/populate-municipios:
    post:
      security:
        - BasicAuth: []
      tags:
        - Scripts
      parameters:
        - $ref: '#/components/parameters/override'
      responses:
        202:
          description: Script foi iniciado de forma assincrona
        401:
          description: Credenciais inválidas ou não fornecidas.
  /scripts/queimadas/upload:
    post:
      security:
        - BasicAuth: []
      tags:
        - Scripts
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/zipfile'
      responses:
        201:
          description: Arquivo foi salvo e descompactado com sucesso!
        401:
          description: Credenciais inválidas ou não fornecidas.
        400:
          description: Arquivo não foi enviado ou algum diretório não segue o padrão de nome definido
        500:
          description: Erro ao descompactar o arquivo!
  /uploads/shapefiles/assentamentos:
    post:
      security:
        - BasicAuth: []
      tags:
        - Uploads
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/zipShapefile'
      responses:
        201:
          description: Arquivo foi salvo e descompactado com sucesso!
        401:
          description: Credenciais inválidas ou não fornecidas.
        400:
          description: Arquivo não foi enviado ou é um formato não permitido.
        500:
          description: Erro ao descompactar o arquivo!
  /uploads/shapefiles/lotes:
    post:
      security:
        - BasicAuth: []
      tags:
        - Uploads
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/zipShapefile'
      responses:
        201:
          description: Arquivo foi salvo e descompactado com sucesso!
        401:
          description: Credenciais inválidas ou não fornecidas.
        400:
          description: Arquivo não foi enviado ou é um formato não permitido.
        500:
          description: Erro ao descompactar o arquivo!
  /uploads/shapefiles/fotos:
    post:
      security:
        - BasicAuth: []
      tags:
        - Uploads
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/zipShapefile'
      responses:
        201:
          description: Arquivo foi salvo e descompactado com sucesso!
        401:
          description: Credenciais inválidas ou não fornecidas.
        400:
          description: Arquivo não foi enviado ou é um formato não permitido.
        500:
          description: Erro ao descompactar o arquivo!
  /uploads/shapefiles/pontos:
    post:
      security:
        - BasicAuth: []
      tags:
        - Uploads
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/zipShapefile'
      responses:
        201:
          description: Arquivo foi salvo e descompactado com sucesso!
        401:
          description: Credenciais inválidas ou não fornecidas.
        400:
          description: Arquivo não foi enviado ou é um formato não permitido.
        500:
          description: Erro ao descompactar o arquivo!
  /uploads/fotos:
    post:
      security:
        - BasicAuth: []
      tags:
        - Uploads
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/zipFotos'
      responses:
        201:
          description: Arquivo foi salvo e descompactado com sucesso!
        401:
          description: Credenciais inválidas ou não fornecidas.
        400:
          description: Arquivo não foi enviado ou é um formato não permitido.
        500:
          description: Erro ao descompactar o arquivo!
  /scripts/queimadas:
    post:
      security:
        - BasicAuth: []
      tags:
        - Scripts
      responses:
        202:
          description: Script foi iniciado de forma assincrona
        401:
          description: Credenciais inválidas ou não fornecidas.
    delete:
      security:
        - BasicAuth: []
      tags:
        - Scripts
      parameters:
        - $ref: '#/components/parameters/prefix'
      responses:
        200:
          description: Deletado
        400:
          description: Prefixo não foi enviado ou não está cadastrado
        401:
          description: Credenciais inválidas ou não fornecidas.

  /scripts/estatisticas:
    post:
      security:
        - BasicAuth: []
      tags:
        - Scripts
      parameters:
        - $ref: '#/components/parameters/override'
      responses:
        202:
          description: Script foi iniciado de forma assincrona
        401:
          description: Credenciais inválidas ou não fornecidas.
  /spec:
    get:
      tags:
        - Specification
      responses:
        200:
          description: Return the API specification

components:
  securitySchemes:
    BasicAuth:
      type: http
      scheme: basic

  parameters:
    municipio_id:
      in: path
      name: id
      schema:
        type: integer
        example: 5003207
      required: true
    assentamento_id:
      in: path
      name: id
      schema:
        type: integer
        example: 1
      required: true
    estado_id:
      in: path
      name: id
      schema:
        type: integer
        example: 50
      required: true
    bioma_id:
      in: path
      name: id
      schema:
        type: integer
        example: 6
      required: true
    bioma:
      in: path
      name: id
      schema:
        type: string
        example: pantanal
        enum:
          - amazonia
          - caatinga
          - cerrado
          - mata_atlantica
          - pampa
          - pantanal
      required: true
    tipoShapefile:
      in: path
      name: tipo
      schema:
        type: string
        example: pantanal
        enum:
          - assentamentos
          - fotos
          - lotes
          - pontos
      required: true
    per_page:
      in: query
      name: per_page
      schema:
        type: number
        minimum: 100
        default: 100
      required: false
    page:
      in: query
      name: page
      schema:
        type: number
        minimum: 1
        default: 1
      required: false
    detailed:
      in: query
      name: detailed
      schema:
        type: boolean
        default: false
      required: false
    source:
      in: path
      name: source
      schema:
        type: string
        default: latest
      required: true
    year:
      in: query
      name: year
      schema:
        type: string
      required: false
    full:
      in: query
      name: full
      schema:
        type: boolean
        default: false
      required: false
    override:
      in: query
      name: override
      schema:
        type: boolean
        default: false
      required: false
    prefix:
      in: query
      name: prefix
      schema:
        type: string
      required: true
  schemas:
    zipfile:
      type: object
      properties:
        zipfile:
          type: string
          format: binary
          description: Arquivo zip contendo os shapefiles separados por pastas no formato YYYYMM
    zipShapefile:
      type: object
      properties:
        zipfile:
          type: string
          format: binary
          description: Arquivo zip contendo todos os arquivos relacionados ao shapefile
    zipFotos:
      type: object
      properties:
        zipfile:
          type: string
          format: binary
          description: Arquivo zip contendo as fotos no formato jpg
